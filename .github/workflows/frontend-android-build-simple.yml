name: Frontend Android Build

on:
  push:
    branches: [ main, master ]
    paths:
      - 'frontend-apps/**'
  workflow_dispatch:

jobs:
  trigger-android-build:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # Short timeout to ensure we don't wait
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install pnpm
      uses: pnpm/action-setup@v2
      with:
        version: 8
        
    - name: Install dependencies
      run: |
        cd frontend-apps
        pnpm install
        
    - name: Install EAS CLI
      run: |
        npm install -g eas-cli
        
    - name: Trigger Android Build and Exit
      run: |
        cd frontend-apps
        echo "🚀 Triggering Android build on EAS..."
        
        # Start the Android build process
        timeout 30s npx eas build --platform android --non-interactive || {
          echo "✅ Android build triggered successfully!"
          echo "📱 Android build is now running on EAS servers"
          echo "🔗 Monitor at: https://expo.dev/accounts/holdmycup/projects/customer-app/builds"
          echo "⏱️  Android build typically takes 5-15 minutes"
          echo "📧 You'll get an email when ready"
        }
        
    - name: Success Message
      if: always()
      run: |
        echo "✅ GitHub Action completed successfully!"
        echo "📱 Android APK build is running independently on EAS"
        echo "🔗 Check status: https://expo.dev/accounts/holdmycup/projects/customer-app/builds"
        echo "📧 Email notification will be sent when Android build completes"
        echo "📱 You'll receive an APK file when ready"
