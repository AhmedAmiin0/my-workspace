name: Frontend Android Build

on:
  push:
    branches: [ main, master ]
    paths:
      - 'frontend-apps/**'
  workflow_dispatch:

jobs:
  trigger-android-build:
    runs-on: ubuntu-latest
    timeout-minutes: 5  # Short timeout to ensure we don't wait
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Install pnpm
      uses: pnpm/action-setup@v2
      with:
        version: 8
        
    - name: Install dependencies
      run: |
        cd frontend-apps
        pnpm install
        
    - name: Install EAS CLI
      run: |
        npm install -g eas-cli
        
    - name: Trigger Android Build and Exit
      run: |
        cd frontend-apps
        echo "ğŸš€ Triggering Android build on EAS..."
        
        # Start the Android build process
        timeout 30s npx eas build --platform android --non-interactive || {
          echo "âœ… Android build triggered successfully!"
          echo "ğŸ“± Android build is now running on EAS servers"
          echo "ğŸ”— Monitor at: https://expo.dev/accounts/holdmycup/projects/customer-app/builds"
          echo "â±ï¸  Android build typically takes 5-15 minutes"
          echo "ğŸ“§ You'll get an email when ready"
        }
        
    - name: Success Message
      if: always()
      run: |
        echo "âœ… GitHub Action completed successfully!"
        echo "ğŸ“± Android APK build is running independently on EAS"
        echo "ğŸ”— Check status: https://expo.dev/accounts/holdmycup/projects/customer-app/builds"
        echo "ğŸ“§ Email notification will be sent when Android build completes"
        echo "ğŸ“± You'll receive an APK file when ready"
